const mongoose = require('mongoose');
mongoose.Promise = require('bluebird');

module.exports = app => {
    let firstConnectTimeout = null;
    mongoConnect(app);

    function mongoConnect(app) {
        const mongoDB = mongoose.connect(app.settings.db.uri, {
            useMongoClient: true
        });

        mongoDB
            .then((db) => {
                clearTimeout(firstConnectTimeout);
            })
            .catch((err) => {
                firstConnectTimeout = setTimeout(mongoConnect, 5000);
            });
    };
};