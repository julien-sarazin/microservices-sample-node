const _ = require('lodash');

module.exports = (requirements) => {
    return (req, res, next) => {
        if (!req.body)
            return res.status(400).send();

        const missings = [];

        if (requirements.constructor.name === 'Schema') {
            let schema = requirements;
            for (let property in schema.obj) {
                if (schema.obj.hasOwnProperty(property)) {
                    if (schema.obj[property].required) {
                        if (req.body[property] === undefined || req.body[property] === null)
                            missings.push(property)
                    }
                }
            }
        }

        else if (requirements.constructor.name === 'String')
            requirements = [requirements];

        else if (requirements.constructor.name === 'Array') {
            for (let requirement of requirements) {
                if (_.get(req.body,requirement) === undefined || _.get(req.body, requirement) === null)
                    missings.push(requirement)
            }
        }

        if (missings.length > 0) {
            return res.status(400).send({missings: missings});
        }

        next();
    }
};