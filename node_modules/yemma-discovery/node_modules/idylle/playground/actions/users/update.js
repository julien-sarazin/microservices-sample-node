module.exports = app => {
    const User = app.models.User;

    return Action({
        execute: (context) => {
            if (context.user && context.user.id && context.user.id !== context.params.id)
                return new ActionError('not.allowed', 403);

            return User
                .findByIdAndUpdate(context.params.id, context.data)
                .then(Utils.ensureOne({code: 404, reason: 'user.not.found'}))
                .then(context.noContent);
        }
    });
};
